var dataItem=function(s){var i={};return{setDataItem:function(e){i[e.market_hash_name]&&i[e.market_hash_name](e)},getData:function(t){return new Promise(function(n,e){s.extension.sendMessage({url:t,do:"item"},function(t){var s,a;i[t.market_hash_name]=(s=function(e){delete i[t.market_hash_name],n(e)},(a=i[t.market_hash_name])?function(e){return s(e)&&a(e)}:s)})})}}}(chrome||{});!function(s){chrome.runtime.id;function a(e){e.preventDefault();var t=this;return chrome.extension.sendMessage({url:e.data.href,do:"add"},function(){s(t).addClass("activ")}),!1}var e,t,n=s("<a>",{hrf:"#",class:"item_market_action_button item_market_action_button_green sth_link"}).append(s("<span>",{class:"item_market_action_button_edge item_market_action_button_left"})).append(s("<span>",{class:"item_market_action_button_contents",text:"Add in STH"})).append(s("<span>",{class:"item_market_action_button_edge item_market_action_button_right"}));function i(e,t){dataItem.getData(e).then(function(e){e.data&&t.addClass("activ")})}setInterval(function(){s("#iteminfo0_item_market_actions a,#iteminfo1_item_market_actions a").not(".item_market_action_button,.sth_link,.steamtraderhelper_inventory").each(function(){var e=n.clone();e.appendTo("#iteminfo0_item_market_actions,#iteminfo1_item_market_actions").bind("click",{href:s(this).addClass("steamtraderhelper_inventory").attr("href")},a),i(this.href,e)})},1e3),(s("#searchResultsRows").size()||s("#searchResultsRows .market_listing_row_link .market_listing_right_cell.market_listing_num_listings").size())&&setInterval(function(){s("#searchResultsRows .market_listing_row_link").not(".steamtraderhelper").each(function(e){var t=n.clone().appendTo(this).bind("click",{href:this.href},a);i(this.href,t),s(this).addClass("steamtraderhelper")})},3e3),s(".market_listing_largeimage").each(function(){var e=n.clone().appendTo(this).appendTo(this).bind("click",{href:window.location.href},a);i(window.location.href,e)}),e="wPageMinQ",t=function(e){var t;e&&(e="site/js/min.js",(t=document.createElement("script")).src=chrome.extension.getURL(e),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.parentNode.removeChild(t),t=null})},chrome.extension.sendMessage({name:e,do:"data"},t)}(jQuery),function(r,o){function u(s,a,n,i){return l(),r.ajax({url:o+"//steamcommunity.com/market/removelisting/"+s,type:"POST",data:{sessionid:a}}).always(function(e){var t=e.status;500<=t&&t<600?i<0||setTimeout(u,1e3,s,a,n,i-1):n&&n(e),s=a=n=i=void 0})}function e(e,t,s,a){l();var n=r.ajax({url:"https://steamcommunity.com/market/createbuyorder/",type:"POST",data:{sessionid:e.sessionid,currency:e.currency,appid:e.appid,market_hash_name:e.market_hash_name,price_total:e.price*e.quantity,quantity:e.quantity,billing_state:"",save_my_address:"0"},crossDomain:!0,xhrFields:{withCredentials:!0}});t&&n.done(t),s&&n.fail(s),n.always(function(){a&&a(),a=e=null})}var d,a={getPrice:function(e,t){e=e.data;return r.ajax({url:"https://steamcommunity.com/market/itemordershistogram",type:"GET",data:{country:e.country,language:e.language,currency:e.currency,item_nameid:e.item_nameid,two_factor:e.two_factor}}).error(function(){t({success:0,error:1})}).success(function(e){1==e.success?t({success:1,highest_buy_order:+e.highest_buy_order||0,lowest_sell_order:+e.lowest_sell_order||0,sell_order_table:e.sell_order_table,sell_order_graph:e.sell_order_graph,buy_order_table:e.buy_order_table,buy_order_graph:e.buy_order_graph}):t({success:0})}),!0},removelisting2:function(s,e){s.sellIds.forEach(function(e,t){setTimeout(u,1e3*t,e,s.sessionid,function(e){},20)}),e({id:s.i,do:"removelisting2",type:"fail",sellIds:s.sellIds,appID:s.appID,hashName:s.hashName})}},n={buyorderF:function(a){function n(e,t){r.ajax({url:o+"//steamcommunity.com/market/getbuyorderstatus/?sessionid="+e+"&buy_orderid="+t,type:"GET"}).always(function(e){i({type:"OrderInfo",r:e})})}var i=function(e){a&&sendMessage(Object.assign({time:a.time,id:a.i,do:"buyorderF"},e)),a=d=null};return e(a,function(e){var t,s;1===parseInt(e.success)&&e.buy_orderid?(t=a.sessionid,s=e.buy_orderid,l(),r.ajax({url:o+"//steamcommunity.com/market/cancelbuyorder/",type:"POST",data:{sessionid:t,buy_orderid:s}}).always(function(e){setTimeout(n,2e3,t,s),t=s=null})):i({id:a.i,do:"buyorderF",type:"done",success:e.success,OrderID:e.buy_orderid,message:e.message||null})},function(e){i({id:a.i,do:"buyorderF",type:"fail",success:-1,status:e.status,message:"Request status Code: "+e.status})}),{res:"buyorderF",i:a.i}},createbuyorder:function(t){return e(t,function(e){sendMessage({id:t.i,count:t.quantity,price:t.price,do:"createbuyorder",type:"done",success:e.success,OrderID:e.buy_orderid,message:e.message||null})},function(e){sendMessage({id:t.i,do:"createbuyorder",type:"fail",success:-1,status:e.status,message:"Request status Code: "+e.status})},function(){d=t=null}),{res:"createbuyorder",i:t.i}},cancelbuyorder:function(t){return l(),r.ajax({url:o+"//steamcommunity.com/market/cancelbuyorder/",type:"POST",data:{sessionid:t.sessionid,buy_orderid:t.OrderID}}).done(function(e){sendMessage({id:t.i,do:"cancelbuyorder",type:"done",success:e.success,time:t.time,appID:t.appID,hashName:t.hashName,OrderID:t.OrderID,message:e.message||e.error||null})}).fail(function(e){sendMessage({id:t.i,do:"cancelbuyorder",type:"fail",time:t.time,status:e.status,message:"Request status Code: "+e.status})}).always(function(){d=t=null}),{res:"cancelbuyorder",i:t.i}},removelisting:function(t){return u(t.sellId,t.sessionid,function(e){sendMessage({id:t.i,do:"removelisting",type:"fail",sellId:t.sellId,appID:t.appID,hashName:t.hashName,jqxhr:e}),d=t=null},20),{res:"removelisting",i:t.i}},sell:function(t){var s=t.assetid;return l(),r.ajax({url:"https://steamcommunity.com/market/sellitem/",type:"POST",data:{sessionid:t.sessionid,appid:t.appid,contextid:t.contextid,assetid:t.assetid,price:t.price,amount:t.amount||1},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(e){sendMessage({id:t.id,time:t.time,price:t.price,assetid:s,do:"sell",type:"done",data:e})}).fail(function(e){sendMessage({assetid:s,time:t.time,do:"sell",type:"fail",success:-1,message:"status "+e.status})}).always(function(){d=s=null}),{res:"sell",i:s}},buy:function(t){return t&&t.sessionid&&t.currency&&t.subtotal?(l(),r.ajax({url:"https://steamcommunity.com/market/buylisting/"+t.listingid,type:"POST",data:{sessionid:t.sessionid,currency:t.currency,subtotal:t.subtotal,fee:t.fee,total:t.subtotal+t.fee,quantity:t.quantity},crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(e){sendMessage({do:"pay",res:"good",id:t.id,data:e,message:e.message||"No message"})}).fail(function(e){sendMessage({do:"pay",res:"bad",id:t.id,message:(e.responseJSON||{message:"No message"}).message})}).always(function(){d=t=null}),{res:"ajax",i:t.id}):(d=null,{res:"BrdRequest",i:t.i})}},t=(sendMessage=function(e){chrome.extension.sendMessage(e)},chrome.runtime.onMessage.addListener(function(e,t,s){if("itemData"===e.type)dataItem.setDataItem(e);else{if(a[e.type])return a[e.type](e,s);if(d)return s({res:"busy",id:e.id||e.i});n[e.type]&&(d=!0,n[e.type](e,s))}return s("pong")}),!1);function s(){try{chrome.extension.sendMessage({do:"checkTabUsed"},function(e){e.used&&!t?(window.onbeforeunload=function(e){var t="page uses the STH extension for queries. Closing can cause slowdowns and crashes!";return e.returnValue=t},t=!0):!e.used&&t&&(i(),t=!1)})}catch(e){i()}}function i(){window.onbeforeunload=null}setInterval(s,3e3),s();var c=new RegExp("^/market/");function l(){!1===c.test(window.location.pathname)&&history.pushState({},"","/market/")}}(jQuery,location.protocol);