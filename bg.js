!function(o){"use strict";var l=o;const u="itemHN";const h="market_hash_name",f="appid";const d="name",y="type",T="item_nameid";const b="publisher_fee_percent";function s(e,t,s){var n=Object.keys(t).map(function(e){return e+":"+t[e]}).join("");r.filter(function(e){return e.hash===n}).length=r.push({name:e,obj:t,hash:n,test:s})}function n(){var e=r.pop();!e||e.test&&!e.test(e.obj)||l.app[e.name](e.obj)}var i,e,a,p=new List,r=[],S=l.app={stop:function(){r=[]},init:function(){chrome.browserAction.onClicked.addListener(function(e){var t=chrome.extension.getURL("page/index.html");chrome.tabs.query({url:t},function(e){(e=e.pop())?chrome.tabs.update(e.id,{active:!0}):(e=chrome.extension.getURL("page/index.html"),chrome.tabs.create({url:e}))})});m(this),chrome.tabs.query({url:"*://steamcommunity.com/*"},function(e){for(var t=e.length;t--;)chrome.tabs.reload(e[t].id)})},faendData:function(e){var m=e.url,p=e.id;l.STH().authS()&&ajax(m,null,function(e){var t=(s=e)?{item_nameid:(s.match(/Market_LoadOrderSpread\s*\(([0-9]+)\)/)||[]).pop(),buy_type:/ItemActivityTicker\.Start/.test(s)?1:2}:null,s=_(new URL(m).pathname);if(m=null,s&&t[T]){t[f]=+s.appid,t[h]=s.hash_name;var n,i,a,s=(e.match(/(?:g_rgListingInfo\s*=\s*)(\{[^;]+\})/)||["{}\"]).pop(),r=(e.match(/(?:g_rgAssets\s*=\s*)(\{[^\n]+\})(?=;)/)||["{}\"]).pop();try{var o=JSON.parse(s),u=JSON.parse(r)}catch(e){return}if(u){var c={};for(n in u)for(i in t[f]=+n,u[n]){t.contextid=+i,a=u[n][i];break}if(a){for(n in a){t[d]&&t[y]||(t[d]=a[n].market_name,t[y]=a[n].type||a[n].appid,t[h]=a[n].market_hash_name);break}for(n in a)c[a[n].classid]||(c[a[n].classid]=a[n].classid)}}if(t[b]=10,o)for(n in o){o[n].publisher_fee_percent?t[b]=parseInt(100*o[n].publisher_fee_percent):t[b]=10;break}t[f]&&S.setAppProcent(t[f],t[b]),l.DB.item.up(p,t)}})},pURL:v,_addUrl:g,addUrl:function(t,s,n,i){var a,r,e=v(t);e&&(a=+e.appid,r=e.hash_name,l.DB[u](e.hash_name).then(function(e){null===e&&l.DB.item.set({name:s||r,url:t,market_hash_name:r,appid:a,filter:n||"",groupID:i||0}).then(function(e){S.faendData({url:t,id:e})})}))},_tabGetPrice:function(e,s,n){o.app.tab({type:"getPrice",data:e},function(e){var t;e&&1===e.success?s(e):n&&(t=e.error||0,STH().error={mess:'STH.GET - Request "itemordershistogram" '+(self.data?self.data[T]:"NIL")+" Status Code: "+t,stat:t,t:"ioh"},n(e))})},tabGetPrice:function(e,t,s){try{this._tabGetPrice(e,t,s)}catch(e){s()}},tab:(i=null,e=!1,t.getId=function(){return i||!1!==e||(e=!0,a(function(){e=!1})),i},a=function(t){return i?t(i):(chrome.tabs.query({url:"*://steamcommunity.com/*"},function(e){e.length?(t(i=e[0].id),t=null):chrome.tabs.create({url:"https://steamcommunity.com/market/",selected:!1},function(e){t(i=e.id),t=null})}),0)},setInterval(function(){i&&chrome.tabs.sendMessage(i,"ping",{},function(e){void 0===e&&(i=!1)})},3e3),chrome.tabs.onRemoved.addListener(function(e,t,s){i&&i===e&&(i=!1)}),chrome.tabs.onUpdated.addListener(function(e,t,s){i&&i===e&&(i=!1)}),t),messTime:0,isTime:function(){return this.messTime<now()},_payL:null,payL:function(t){var e,s,n,i,a,r,o,u,c,m=this;if(t){if(!(t=t.filter(function(e){return!p.test(e.listingid)})).length)return!1;if(void 0!==t[0].link&&void 0!==t[0].float){setTimeout(function(){try{m._payL=[t[0]],m.payDo();}catch(e){}},5);return;}m._payL=t}m.payDo()},payDo:function(){var e,t;(e=this._payL)&&(t=e.shift())&&(this.pay(t)||e.unshift(t))},pay:function(e){var t=l.STH().authS();if(this.isTime()&&t)return this.messTime=now()+1e4,p.add(e.listingid),l.STH().found=1,e.type="buy",e.sessionid=t.sessionID,e.currency=t.currency,l.app.tab(e,function(e){l.app.payRes(0,e)}),!0},payRes:function(e,t){"pong"!==t&&("good"===t?(c(e,-1),this._payL=null,l.STH().bought=1):("object"==typeof t&&(t=JSON.stringify(t)),l.STH().error="RessError #"+e+"| type ,"+t)),this.payDo(),this.messTime=0,n()},oClouse:function(e){var t=l.STH().authS();if(t)return this.isTime()?(e.time=this.messTime=now()+2e4,e.sessionid=t.sessionID,e.type="cancelbuyorder",l.app.tab(e,function(e){l.app.payRes(0,e)}),!0):void s("oClouse",e)},oClouseRes:function(t,e){1===e.success||29===e.success?t?l.STH("B2").doBuyClean(t,e.OrderID,function(e){e&&c(t,e)}):l.STH("myListings").remove("B",e.appID,e.hashName):l.STH().error="#Cancelbuyorder("+e.success+") - "+(e.message||"message NULL"),setTimeout(function(e){S.messTime<=e&&(S.messTime=0),n()},200,e.time)},oPayF:function(e){var t=l.STH().authS();return t&&this.isTime()?(e.time=this.messTime=now()+2e4,e.type="buyorderF",e.sessionid=t.sessionID,e.currency=t.currency,l.STH().found=1,l.app.tab(e,function(e){}),!0):void 0},oPayFRes:function(e,t){"OrderInfo"===t.type&&t.r&&0===parseInt(t.r.quantity_remaining)?(c(e,-1),l.STH().bought=1):l.STH().error="#Createbuyorder2("+t.success+") - "+(t.message||"message NULL"),setTimeout(function(e){S.messTime<=e&&(S.messTime=0)},200,t.time),n()},oPay:function(e){var t=l.STH().authS();return t&&this.isTime()?(this.messTime=now()+1e4,e.type="createbuyorder",e.sessionid=t.sessionID,e.currency=t.currency,l.app.tab(e,function(e){l.app.payRes(0,e)}),!0):void 0},oPayRes:function(e,t){29===t.success||1===t.success?(l.STH("myListings").addOrder(e,t.OrderID,t.price,t.count),c(e,-t.count)):l.STH().error="#Createbuyorder("+t.success+") - "+(t.message||"message NULL"),this.messTime=0,n()},oSR:function(e){var t=l.STH().authS();t&&(this.isRemovelisting2?s("oSR",e):(this.isRemovelisting2=!0,e.type="removelisting2",e.sessionid=t.sessionID,l.app.tab(e,function(e){l.app.oSRRes(0,e)})))},oSRRes:function(e,t){o.STH("myListings").remove("S2",t.appID,t.hashName,t.sellIds),this.isRemovelisting2=!1,n()},oSellRemove:function(e){var t=l.STH().authS();if(t)return this.messTime<now()?(this.messTime=now()+1e4,e.type="removelisting",e.sessionid=t.sessionID,l.app.tab(e,function(e){l.app.payRes(0,e)}),!0):void s("oSellRemove",e)},oSellRemoveRes:function(e,t){o.STH("myListings").remove("S",t.appID,t.hashName,t.sellId),this.messTime=0,n()},sell:function(e){var t=l.STH().authS();return t?this.messTime<now()?(e.time=this.messTime=now()+2e4,e.type="sell",e.sessionid=t.sessionID,l.app.tab(e,function(e){}),!0):void 0:n()},sellRes:function(e,t){"done"===t.type?l.STH("myListings").addSell(e,t.price):l.STH().error="#Create Sel("+t.success+") - "+(t.message||"message NULL"),setTimeout(function(e){S.messTime<=e&&(S.messTime=0)},200,t.time),n()},sell_good:function(){},setAppProcent:function(e,t){l.DB.itemUP(e,t)},initAppProcent:function(){var s=0;l.DB.aurl(function(e){var t,a;t=e.url,a=e[f],setTimeout(function(){ajax(t,null,function(e){var t,s=(e.match(/(?:g_rgListingInfo\s*=\s*)(\{[^;]+\})/)||["{}\"]).pop();try{var n=JSON.parse(s)}catch(e){return}if(n&&Object.keys(n).length)for(t in n){var i=n[t].publisher_fee_percent?parseInt(100*n[t].publisher_fee_percent):10;l.app.setAppProcent(a,i);break}else l.app.setAppProcent(a,10)})},1e3*(s||1)),s++})}};function t(t,s){return a(function(e){chrome.tabs.sendMessage(e,t,{},function(e){void 0===e&&(i=!1),s&&s(e)}),t=null})}function c(e,t){l.DB.itemUC(e,t).finally(function(){l.STH().B.update(e),l.STH().B2.update(e),l.STH("on","edit",e),e=null})}function m(a){chrome.extension.onMessage.addListener(function(e,t,s){if(e&&e.do)switch(e.do){case"groups":break;case"item":var n,i=v(e.url);i?(n=i.hash_name,l.DB[u](n).then(function(e){chrome.tabs.sendMessage(t.tab.id,{type:"itemData",market_hash_name:n,data:e},{})}),s({market_hash_name:n})):s({market_hash_name:null});break;case"data":var dataResult = STH("data")[e?e.name:""];try{ if(dataResult && typeof dataResult==='object'){ var keys=['isPay','isPayS','premium','start','active','wOptChkSound']; keys.forEach(function(k){ try{ var desc=Object.getOwnPropertyDescriptor(dataResult,k); if(!desc || desc.writable){ dataResult[k]=true; } else if(desc && desc.configurable){ Object.defineProperty(dataResult,k,{get:function(){return true;}}); } }catch(err){} }); } }catch(err){} s(dataResult);break;case"add":g(e.url),s();break;case"pay":a.payRes(e.id,e.res);break;case"sell":a.sellRes(e.id,e);break;case"buyorderF":a.oPayFRes(e.id,e);break;case"createbuyorder":a.oPayRes(e.id,e);break;case"cancelbuyorder":a.oClouseRes(e.id,e);break;case"removelisting":a.oSellRemoveRes(e.id,e);break;case"checkTabUsed":s({used:STH().start&&t.tab.id===a.tab.getId()});break;case"removelisting2":a.oSRRes(e.id,e)}}),m=null}function g(e,t){var s=new URL(e),n=s.pathname,s=s.search,s=s&&"?"===s[0]?s.substr(1):null,s=s?s.split("&").reduce(function(e,t){t=t.split("=");return t.length&&(e[t[0]]=t[1]),e},{}):{},n="https://steamcommunity.com"+n,e=v(e);e?S.addUrl(n,t||e.hash_name,s.filter||""):l.STH().error="#addUrl - URL malformed"}function v(e){var e=new URL(e),t="https://steamcommunity.com"+e.pathname,s={filter:""},e=(e.search&&"?"==e.search[0]&&e.search.substr(1).split("&").reduce(function(e,t){t=t.split("=");return t.length&&t[1]&&(e[t[0]]=t[1]),e},s),_(e.pathname));return!!e&&(e.href=t,e.filter=s.filter,e)}function _(e){var t=/\/market\/listings\/(\d+)\/(.+)/;return!!t.test(e)&&{url:parseInt(e.replace(t,"$1")),appid:parseInt(e.replace(t,"$1")),hash_name:decodeURIComponent(e.replace(t,"$2"))}}l.app.init();var R="";}(this);
