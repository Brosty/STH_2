!function(a){"use strict";var s=a;const i="filter";const u="b_cnt";const o="b_summ";const n="min_float";function c(){return a.STH("data").wOptChkClassick&&(!a.STH("isPay")||3!=+a.STH("data").wOptType)}function l(t){return t&&730==t.appid&&t.max_float<=t[n]&&(0<t[n]&&t[n]<1||0<t.max_float&&t.max_float<1)}function f(t){return t?parseInt(100*parseFloat(t.replace(",",".").replace(/(?=.*\d)(\.)(?=\d{3})/g,"").replace(/[^0-9\.]/g,""))):0}function r(t,n,e){var a=s.STH("authS")();a&&F(t,e,a.country,a.currency,n).c().fail(function(t){s.STH().error={mess:"STHB-2 - Pre price "+t,stat:t,t:"pp"}}).l("pp")}function p(n,e,a){var t=["query="+a,"start=0","count=10","search_descriptions=0","sort_column=popular","sort_dir=desc","appid="+e];return s.get("https://steamcommunity.com/market/search/render/?"+t.join("&"),"json").done(function(t){t.success&&(t=M("<div>"+t.results_html,e,a))&&I[n].price(t).data.b_summ>=t&&I[n].scan()}).always(function(){e=a=n=null}).l("ppS")}function d(n,e,a){var t=["appid="+e,"q="+encodeURIComponent(a)];return s.get("https://steamcommunity.com/market/search?"+t.join("&")).done(function(t){t&&(t=M(t,e,a))&&I[n].price(t).data.b_summ>=t&&I[n].scan()}).always(function(){e=a=n=null}).l("ppS_html")}function h(t,n,e,a){return t||n||e?[t,n,e][a]?[r,d,p][a]:h(t,n,e,+k):function(){}}function m(){if(s.STH("start")&&s.STH("SS").page&&c()&&(!s.STH("isPay")||s.STH("data").wOptionsChkPageC)){var t,n=0,e=new ArrayBuffer(8);for(t in I)e[n]=t,n++;t=!1,n&&(t=I[e[j=n<=j?0:j]].scan(),++j),t||setTimeout(m,10)}}function t(){s.DB.getItemIdsWithOnFilters().then(function(n){var e=Object.keys(I).map(function(t){return parseInt(t)}),t=n.filter(function(t){return-1===e.indexOf(t)}),a=e.filter(function(t){return-1===n.indexOf(t)});t.length&&x.add(t),a.length&&x.remove(a)})}var e,v,_,S,g,y=0,T=(e=s.STH("data"),function(){var t,n=!!e.wOptionsChkHTML;return!s.STH("isPay")||(t=!!e.wOptionsChkJSON,n&&t?rand(0,10)<6:n)}),H={fnPage:{S:function(){return 32e3},M:function(){return 12e3},F:function(){return 4e3},C:function(){return+s.STH("data").wOptionsRatePageC||2e3}},val:0,setVal:limit(function(){var t=s.STH("isPay");this.val=randProc(this.fnPage[t?"C":s.STH("data").wOptionsRate||"S"](),t&&s.STH("data").wOptionsRandomMode||50)},3e3),valueOf:function(){return this.setVal(),Math.max(this.val,500)}},w={fnPage:{S:function(){return 6e3},M:function(){return 2e3},F:function(){return 1e3},C:function(){return+s.STH("data").wOptionsRateNL||2e3}},val:0,setVal:limit(function(){this.val=randProc(this.fnPage[s.STH("isPay")?"C":s.STH("data").wOptionsRate||"S"](),s.STH("data").wOptionsRandomMode||50)},3e3),valueOf:function(){return this.setVal(),Math.max(this.val,500)}},O=function(t,n){var e=parseInt,a=e(t.converted_price_per_unit),r=e(t.converted_price_per_unit)+e(t.converted_fee_per_unit),i=e(t.converted_fee_per_unit),u=e(t.converted_publisher_fee_per_unit),e=e(t.converted_steam_fee_per_unit);return i==u+e&&r==a+u+e&&(n&&(r-=e,i-=e),{currencyid:t.converted_currencyid,listingid:t.listingid,subtotal:a,fee:i,total:r,price:r})},P={},I={},R=Class({timeI:0,id:null,constructor:function(t){if(I[t])return I[t];var n=I[t]=this;n.id=t,n._nr()},_nr:function(){var n=this;n.interval2=myInterval(function(){var t;n&&(t=n.nlName())&&(P[t]=n,clearMyInterval(n.interval2))},700,function(){n.interval2=null,n=null})},stop:function(){var t=this,n=t.nlName();n&&delete P[n],delete I[t.id],t.interval&&clearMyInterval(t.interval),t.interval2&&clearMyInterval(t.interval2),t.id=t.data=null},update:function(){var n=this;this.loadDB(function(t){(t[u]<=0||t[i]||l(t))&&n.stop(),n=null})},count:function(){return this.data?this.data[u]:null},price:function(t){return t?(this._price=t,this):this._price},payList:function(n){this.loadDB(function(t){0<t[u]&&s.app.payL(n),n=null})},pay:function(n){this.loadDB(function(t){(l(t)||t.filter)&&0<t[u]&&t[o]>=n.price&&s.app.pay(n),n=null})},scan:function(t){var r=this,n=s.STH().authS(),e=now(),t="boolean"==typeof t?t:T();return!(!(a.STH("SS").page&&r.timeI<e&&n&&(r.data?r.data.b_on:(r.loadDB(),0))&&r.data[u]&&r.data[o])||r.get||r.data[i]||l(r.data)||(r.timeI=e+400,r.get=t?s.get(r.data.url).done(function(t){if(r.data){var n,e,a=(t.match(/(?:g_rgListingInfo[\s]*\=[\s]*)(\{[^;]+\})/g)||[]).pop(),t=(t.match(/(?:g_rgAssets[\s]*\=[\s]*)(\{[^\n]+\};)/g)||[]).pop();if(a&&t){try{n=JSON.parse(a.replace(/(?:g_rgListingInfo[\s]*\=[\s]*)(\{[^;]+\})/g,"$1"))||{},e=JSON.parse(t.replace(/(?:g_rgAssets[\s]*\=[\s]*)(\{[^\n]+\});{0,1}/g,"$1"))||{}}catch(t){return}a=r.fL(n,e),n=e=null,a.length&&r.payList(a),y=Math.max(y-.5,0)}}}):s.get(r.data.url+"/render/?start=0&count=10&country="+n.country+"&language="+n.language+"&currency="+n.currency,"json").c(n.language).done(function(t){var n;r.data&&(n=r.fL(t.listinginfo,t.assets),t=t.assets=t.listinginfo=null,n.length&&r.payList(n),n=null,y=Math.max(y-.5,0))}),r.get.fail(function(t){s.STH().error="STHB-2 - Limit recuest "+t}).always(function(){r.get=null,r=null}).l("page"),0))},fL:function(t,n){var t=function(t,n,e){var a,r,i,u,o=[],c=(s.STH().authS()||{}).TwoFactor;for(i in t)r=t[i],(u=O(r,c))&&u.price&&((a=n[r.asset.appid][r.asset.contextid][r.asset.id]).owner||2!=a.status||o.push(Object.assign(u,{id:e,quantity:1}))),a=null;return o}(t,n,this.id),n=this.data.b_summ,e=t.map(function(t){return t.price}).reduce(function(t,n){return Math.min(t,n)})||0;return e&&(this.price(e),e)&&e<=n?t.filter(function(t){return t.price<=this},n).sort(function(t,n){if(t){if("MAX"==n)return function(t,n){return t.price<n.price?1:-1};if("RND"==n)return function(){return.5-Math.random()}}return function(t,n){return t.price>n.price?1:-1}}(STH("isPay"),STH("data").wOptionsRadPP)):[]},nlName:function(){var t=this;return t.__nl||t.data&&t.data.market_hash_name?t.__nl=[t.data.contextid,t.data.appid,t.data.market_hash_name].join("_"):null},loadDB:function(n){var e=this;return s.DB.item.getOne(e.id).then(function(t){t?e.data=t:(e.stop(),n=null)}).catch(function(){e.stop(),n=null}).finally(function(){n&&n.call(e,e.data),e=n=null}),e}}),D={fnPage:{S:function(){return 32e3},M:function(){return 12e3},F:function(){return 4e3},C:function(){return+s.STH("data").wOptionsRatePPrice||1e3}},val:0,setVal:limit(function(){var t=s.STH("isPay");this.val=randProc(this.fnPage[t?"C":s.STH("data").wOptionsRate||"S"](),t&&s.STH("data").wOptionsRandomMode||50)},3e3),valueOf:function(){return this.setVal(),Math.max(this.val,500)}},b=0,F=function(n,t,e,a,r){e=["country="+e,"currency="+a,"appid="+r,"market_hash_name="+t];return s.get("https://steamcommunity.com/market/priceoverview/?"+e.join("&"),"json").done(function(t){t=f(t.lowest_price);I[n].price(t).data.b_summ>=t&&I[n].scan()}).always(function(){n=null}).l("pp")},M=function(t,n,e){var a=s.STH().authS().TwoFactor,r="/market/listings/"+n+"/"+e,i=[];return $(t).find(".market_listing_row_link").filter(function(t,n){return decodeURI(n.pathname)==r}).each(function(t,n){i.push(f($(".market_listing_their_price>span>span"+(a?".normal_price":".sale_price"),n).text()))}),i.length?i.reduce(Math.max,i[0]):0},k={_v:0,valueOf:function(){return this._v,this._v=2<=this._v?0:this._v+1}},C=(_=s.STH("SS"),function(){if(s.STH("start")&&_.page&&_.pp&&s.STH("isPay")&&c()&&s.STH("data").wOptionsChkPPrice){var t,n=0,e=new ArrayBuffer(8);for(t in I)e[n]=t,n++;t=!1,n&&(a=I[e[b=n<=b?0:b]],r=h(_._pp,_._ppS_html,_._ppS,+k),t=a&&((i=a.data)?(i.b_cnt&&r(i.id,i.appid,i.market_hash_name),!0):(a.loadDB(),!1)),++b),t||setTimeout(C,10)}var a,r,i}),j=0,x={remove:function(t){return"object"==typeof t?t.forEach(function(t){x.remove(t)}):I[t]&&I[t].stop()},add:function(t){return"object"==typeof t?t.forEach(function(t,n){setTimeout(function(){x.add(t),t=null},60*n)}):new R(+t)},getCnt:function(t){return I[t]?I[t].count():null},getPrice:function(t){return I[t]?I[t].price():0},stop:function(){g&&clearInterval(g),$.each(I,function(t,n){n.stop()}),"number"==typeof L&&clearMyInterval(L),"number"==typeof S&&clearMyInterval(S),"number"==typeof v&&clearMyInterval(v)},start:function(){this.stop(),g=setInterval(t,3e3),L=myInterval(V,w),S=myInterval(m,H),v=myInterval(C,D)},update:function(t){s.STH("start")&&("object"==typeof t?t.forEach(function(t,n){setTimeout(function(){x.update(t),t=null},10*n)}):I[t]&&I[t].update())}};s.STH("B",x);var L,B,N=null,V=function(){var t=a.STH("authS")();a.STH("SS").page&&a.STH("start")&&t&&a.STH("isPay")&&a.STH("data").wOptionsChkNL&&!B&&(t=["country="+t.country,"language="+t.language,"currency="+t.currency],B=a.get((STH("auth")().nl?"https://steamtraderhelper.com/sth.json?":"https://steamcommunity.com/market/recent?")+t.join("&"),"json").done(function(t){var n,u,o;t.success&&(n=hash(t.hovers))!=N&&(N=n,n=t.listinginfo,u=t.assets,o=(s.STH().authS()||{}).TwoFactor,$.each(n,function(t,n){var e,a,r,i=u[n.asset.appid][n.asset.contextid][n.asset.id],i=i.contextid+"_"+i.appid+"_"+i.market_hash_name;(e=P[i])&&NaN<=(r=(a=O(n,o))?e.data.b_summ:r)&&e.payList([Object.assign(a,{h:i,price:NaN,listingid:n.listingid,currencyid:n.converted_currencyid,subtotal:void 0,fee:void 0,m_price:r,id:e.id,quantity:1})])}),o=null)}).c().fail(function(t){a.STH().error="STHB-2 - NewReLimit recuest "+t}).always(function(){B=null}).l("page"))}}(this);