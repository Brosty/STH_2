!function(i){"use strict";var o=i;const j="groupID";var r="https://steamtraderhelper.com",A=Class({constructor:function(t){this.name=t,this.fns=[]},on:function(n){return this.fns.forEach(function(t){t&&t.apply(o,n||[])}),this},off:function(t){var n=this.fns,e=n.length;if(t)for(;e--;)n[e]&&n[e].sn===t&&(n[e]=n[e].sn=null);else{for(;e--;)n[e]=null;this.fns=[]}},set:function(t,n){this.fns.push(t),n&&(t.sn=n)}}),L=Class({parsName:function(t){return t&&t.split?t.split(":"):[]},constructor:function(){this.l={}},off:function(t){t=this.parsName(t),this.l[t[0]].off(t[1])},on:function(t,n){var e=this;t=e.parsName(t),e.l[t[0]]||(e.l[t[0]]=new A(t)),"function"==typeof n?e.l[t[0]].set(n,t[1]):e.l[t[0]].on([].splice.call(arguments,1))}}),a=!1,t=Class({constructor:function(t){a||(a=!0,this.do(t))},f:function(t){t=JSON.stringify(t);return new File([t],"data.txt",{type:"text/plain",lastModified:now()})},_f:function(t){for(var n=JSON.stringify(t),e=n.length,t=new Uint16Array(e),r={};e--;)r[n.charCodeAt(e)]=(r[n.charCodeAt(e)]||0)+1,t[e]=n.charCodeAt(e);var i,o=r,a=[];for(i in o)a.push({i:i,a:o});a.sort(function(t,n){return t.i>n.i}).map(function(t){return t.a})}}),N=Class({do:function(t){this.type=t,this.get_Item(),this.getItem(),this.getGroup(),a=!0},_end:function(){},getGroup:function(){var n=this;o.DB.group.get().then(function(t){n.group=n.f(t),n.post(),n=null})},getItem:function(){var n=this;o.DB.item.get().then(function(t){n.item=n.f(t),n.post(),n=null})},get_Item:function(){var n=this;o.DB._item.get().then(function(t){n._item=n.f(t),n.post(),n=null})},post:function(){this.group&&this.item&&this._item&&this._post()},_post:function(){var n=this,t=o.STH().authS(),e=new FormData;return e.append("user",t?t.id:null),e.append("version",o.STH("version")),e.append("attr",t?"country="+t.country+"&language="+t.language+"&currency="+t.currency:""),e.append("type",n.type),e.append("exp1",n.group),e.append("exp2",n.item),e.append("exp3",n._item),a=!1,$.ajax({url:r+"/user/api/export_f2/",data:e,type:"POST",dataType:"json",contentType:!1,processData:!1}).done(function(t){n._end(t.res)}).fail(function(){n._end(!1)}).always(function(){n.group=n.item=n._item=null,n=null}),this},end:function(t){return this._end=t,this}},t);function e(t){if(e.do)return!1;o.STH().start&&(o.STH().start=!1),e.do=!0,this.type=t,this.post()}function G(t,n,e){var r=this;r.u=t,r.tl=e||1e4,r.tlB=r.tl,r.tOk=r.tl,r.test=n}e.do=!1;var s,u,p,n=!(G.prototype={t:!(e.prototype={tG:function(){var t=this;o.DB.group.c().finally(function(){t.group=!0,t.save(),t=null})},t_I:function(){var t=this;o.DB._item.c().finally(function(){t._item=!0,t.save(),t=null})},tI:function(){var t=this;o.DB.item.c().finally(function(){t.item=!0,t.save(),t=null})},save:function(){this.item&&this._item&&this.group&&this._save()},_save:function(){var t,n,e=this,r=0;e.o.item.forEach&&e.o.item.forEach(function(t){++r,o.DB.item.set(void 0!==(t=t)[j]?t:{id:+t.id,market_hash_name:t.market_hash_name,url:t.url,appid:t.appid,filter:t.filter,sort:t.sort,groupID:t.id_group,name:t.name,type:t.type,item_nameid:t.item_nameid,buy_type:t.buy_type,contextid:t.contextid,b_cnt:t.b_cnt,b_min:0,b_summ:t.b_summ,b_on:t.b_on,s_on:t.s_on,s_summ:t.s_summ,publisher_fee_percent:t.publisher_fee_percent,min_float:t.min_float,max_float:t.max_float}).finally(function(){--r})}),e.o.group.forEach&&e.o.group.forEach(function(t){++r,o.DB.group.set(t).finally(function(){--r})}),t=r,n=setInterval(function(){r<1?(e.finish(!0),clearInterval(n)):e.s(r,t)},1e3)},post:function(){var n=this;$.get(r+"/user/api/import2/",{type:n.type},function(t){t.item&&t.group?(n.o=t,n.t_I(),n.tI(),n.tG()):n.finish(!1)},"json").error(function(){n.finish(!1)})},s:function(t,n){return this._p&&this._p(Math.ceil(100-t/n*100),t,n),this},finish:function(t){this._end&&this._end(t),e.do=!1,this._p=null,this.o=null},process:function(t){return this._p=t,this},end:function(t){return this._end=t,o.app.initAppProcent(),this}}),u:!1,b:!1,l:"",get Data(){return!!this.isAuth&&new Object(this.data)},test:!1,get get(){var n=this;if(!i.STH("SS").M)return n.tOk=n.tl=1e3,n.l;try{var t=gets(n.u)}catch(t){return n.tOk=n.tl=n.tlB,n.l}return 429===t.status?(o.STH("SS").Mess("m",t.status),n.tOk=n.tl=12*n.tlB,n.l):(n.tOk=1e6,n.l=t.body,n.tl=n.tlB,t.body)},get isAuth(){var t=this;return t.t&&t.t>now()||(t.b=t.test(t.get),t.t=now()+(t.b?t.tOk:t.tl)),t.b}}),c=0,l=0,W=0,F=0,J=0,f=0,U=new G("https://steamcommunity.com/market/",function(t){var n,e,r;return t&&(i.STH("myListings")(t,!0,(r=/total_count: (\d+),\s+pagesize: g_nMySellListingsPageSize,\s+prefix: \S+,\s+class_prefix: 'market'/m).test(e=t)?parseInt((e.match(r)||[0]).pop()):0,(e=/var g_nMySellListingsPageSize = (\d+)/m).test(r=t)?parseInt((r.match(e)||[0]).pop()):10),r=json_parse((t.replace(/[\r\n]*/gm,"").match(/g_rgWalletInfo = (\{[^}]+\})/g)||["{}"]).pop().replace("g_rgWalletInfo = ","")),this.data=null,e=this.data={id:(t.match(/g_steamID = "([^"]+)"/m)||[!1]).pop(),href:(t.match(/\:\/\/steamcommunity\.com(\/profiles\/[^\/]+)/m)||t.match(/\:\/\/steamcommunity\.com(\/id\/[^\/]+)/m)||["/my"]).pop()+"/inventory/",TwoFactor:$((t.match(/<body[^>]*>/g)||["<body>"])[0].replace("body","div")).hasClass("two_factor_sale_enabled"),name:(t.match(/id="account_pulldown"[^\>]+\>([^\<]+)/im)||[]).pop(),balance:(e=((e=t).match(/id="marketWalletBalance"[^\>]*\>(.+)<\//im)||[]).pop())?((n=document.createElement("div")).innerHTML=e,n.innerText):"",sessionID:(t.match(/g_sessionID = "([^"]+)"/m)||[!1]).pop(),language:(t.match(/g_strLanguage = "([^"]+)"/m)||[!1]).pop(),country:r.wallet_country,currency:r.wallet_currency},0),!!(e&&e.sessionID&&e.country&&e.currency)}),Q=new List(20),m={get version(){return chrome.runtime.getManifest().version},get start(){return n},set start(t){((n=t)?X:K)()},get stat(){return new Object({found:c,bought:n?l:0,orders:W,ordersCnt:F,sall:J,errors:n?f:0})},get isPay(){return!(!S.Data||!S.isPay())},get errors(){return Q.val()},set found(t){n&&c++},set bought(t){l+=1,mp3()},set orders(t){W=t},set ordersCnt(t){F=t},set sall(t){J=t},set error(t){Q.add({time:now(),e:t}),f++},on:new L,auth:function(){return S.Data},authS:function(){return U.Data},stimStatus:function(){return d()},data:(s=o.localStorage,t=[h("wPageMinQ","1"),"wOptSellTime","wOptSellIsAuto","wOptSellIsAutoVtep","wOptSellCorrectReplase",h("wOptType","1"),"wOptQORate","wOptQORateRate","wOptQORateStep","wOptItemInfoTime","wOptRateFilter","wOptBuyOrderCorrect","wOptBuyOrderCorrectReplase","wOptBuyOrderCorrectReplaseOnlyPlus","wOptBuyOrderCorrectStep",h("wOptChkSound","1"),"wOptAutoConfirm","wOptBuyOrderCnt","wOptBuyOrderTime","wOptChkClassick",h("wOptChkSSWhenErr","1"),h("wOptionsRate","M"),"wOptionsChkJSON","wOptionsChkHTML","wOptionsChkPPrice","wOptionsRatePPrice","wOptionsChkPageC","wOptionsChkPage","wOptionsChkNL","wOptionsRatePageC","wOptionsRatePage","wOptionsRateNL","wOptionsRandomMode","wOptionsRadPP","wOptionsChkSSWhenErr","wOptionsChkRunTime","wOptionsRateRunTime","wOptionsRateStopTime","wOptionsRandomSS","wOptIgnoreFraudwarnings"],u={},p={},t.forEach(function(t,n){var e="object"==typeof t,r=e?t.name:t;u[r]=(void 0!==s[r]?s[r]:e?t.default:"")||"",p.__defineGetter__(r,function(){return u[r]}),p.__defineSetter__(r,function(t){u[r]=s[r]=t})}),p),export:function(t){var n=this.auth();if(n&&n.subscription)return new N(t)},import:function(t){var n=this.auth();if(n&&n.subscription&&n.backap)return new e(t)},pURL:function(t){return o.app.pURL(t)},addUrl:function(t){o.app._addUrl(t,t)}};function h(t,n){return n?{name:t,default:n}:t}function d(){return d.ido||(d.time||0)>now()||(d.ido=!0,ajax("https://steamtraderhelper.com/steamstat.json","",function(t){var n;d.ido=!1;try{n=JSON.parse(t).services.community.title,t=null}catch(t){}d.v=n||"--",d.time=now()+1e5})),d.v}o.STH=function(t,n,e){return void 0!==t?"on"===t?m[t].on(n,e):void 0!==n?m[t]=n:m[t]:m},d.ido=!1;_=!(g=r),w=!(y={}),z=function(){return $.ajax({type:"GET",url:g+"/user/api/u",dataType:"text",async:!1}).responseText},V=function(t){var n;if(t&&"{"==t[0]){try{n=JSON.parse(t)}catch(t){}y.backap=n.backap,y.user=n.u,y.cd=n.cd,y.subscription=n.cd,y.t=n.t}else y.backap=null,y.user=null,y.subscription=null,y.t=null,delete y.cd;return!(!y||!y.user)},setInterval(function(){chrome.cookies.getAll({url:g},function(t){for(var n,e,r,i,o,a=t.length;a--;)"_e"==t[a].name&&(n=t[a]),"_m"==t[a].name&&(e=t[a]),"_u"==t[a].name&&(r=t[a]);o=n,(i=e)&&o&&(1<(i=Math.ceil((1e3*o.value-now())/1e3/60/60/24)-y.cd||0)||i<-1)&&(y.subscription=null),r&&(o=r,q(),chrome.cookies.remove({url:g,name:o.name,storeId:o.storeId}))})},700);var g,_,y,w,z,V,S={get Data(){return w&&w>now()||(q(),w=now()+1e6),!!_&&new Object(y)},isPay:function(){return!!_&&y&&0<y.subscription&&0<y.cd&&y.cd===y.subscription}};function q(){_=V(z())}var K=function(){f=l=c=0,m.ACT.stop(),m.S.stop(),H.stop()},X=function(){m.ACT.start(),m.S.start(),H.start()};const O="page";b=!1,k={},C={},R={},x={},I={},M("ioh"),M("pp"),M("ppS"),M("ppS_html"),M("m"),M("nl"),M(O,function(n){["pp","ppS","ppS_html","m"].forEach(function(t){I[t](n)})}),M("fortune",function(n){[O,"ordershistogram","activity"].forEach(function(t){I[t](n)})}),M("ordershistogram"),M("activity"),P=0,B=function(){return randProc(6e4*Math.max(o.STH("isPay")&&+o.STH("data").wOptionsRateStopTime||10,1),o.STH("isPay")&&o.STH("data").wOptionsRandomSS||50)},(D={get isOn(){return b},get M(){return!1===b||R.m},get pp(){return R.pp||R.ppS||R.ppS_html},get _pp(){return R.pp},get _ppS(){return R.ppS},get _ppS_html(){return R.ppS_html},get nl(){return R.nl},get page(){return R[O]},get fortune(){return R.fortune},get ordershistogram(){return R.ordershistogram},get ppT_max(){return Math.max(C.pp||0,C.ppS||0,C.ppS_html||0)},get ppT(){return Math.min(C.pp||D.ppT_max,C.ppS||D.ppT_max,C.ppS_html||D.ppT_max)},get nlT(){return C.nl},get pageT(){return C[O]},get fortuneT_max(){return Math.max(C[O]||0,C.ordershistogram||0,C.activity||0)},get fortuneT(){return Math.min(C[O]||D.fortuneT_max,C.ordershistogram||D.fortuneT_max,C.activity||D.fortuneT_max)},get timeOff(){return P},get timeOn(){return T},start:function(){Y(),m.B.start(),m.B2.start(),Object.keys(I).forEach(function(t){R[t]=!0}),b=!0,D.RunTime()},stop:function(){m.B.stop(),m.B2.stop(),i.app.stop(),Y(),b=!1},pause:function(){var t;b&&(t=B(),I.nl(t),I.page(t))},Mess:function(t,n){o.STH("data").wOptChkSSWhenErr&&(x[t]=429==n?-~x[t]:0,2<=x[t])&&I[t]()}}).RunTime=function(){var t;o.STH("data").wOptionsChkRunTime&&b&&o.STH("isPay")&&(isSartTime=!0,t=randProc(6e4*Math.max(+o.STH("data").wOptionsRateRunTime||60,1),o.STH("data").wOptionsRandomSS||50),v&&clearTimeout(v),v=setTimeout(function(){var n;o.STH("data").wOptionsChkRunTime&&(n=B(),Object.keys(I).forEach(function(t){I[t](n)}),v&&clearTimeout(v),v=setTimeout(function(){P=void D.RunTime()},n),P=now()+n)},t),T=now()+t)};var v,T,b,k,C,R,x,I,P,B,D,H=D;function M(n,e){I[n]=function(t){t=t||B();R[n]=!1,k[n]&&clearTimeout(k[n]),k[n]=setTimeout(function(){R[n]=!0},t),e&&e(t),C[n]=now()+t}}function E(n){Object.keys(n).forEach(function(t){n[t]=null})}function Y(){Object.keys(k).forEach(function(t){k[t]&&clearTimeout(k[t])}),E(C),E(R),E(x),P=T=null}o.STH("SS",H)}(window);