!function(p){"use strict";const u="s_on";function l(t,n){return{price:t,subtotal:n}}o={},c={valueOf:function(){return 6e4*Math.max(+p.STH("data").wOptSellTime||15,1)}},f=limit(function(){k(o)},c),d=limit(function(){k(o)},c,function(t){f=t}),p.STH("S",s={remove:function(t){return t.json?t.forEach(function(t){s.remove(t)}):A.stop(t)},add:function(t){return"object"==typeof t?t.forEach(function(t,n){setTimeout(function(){s.add(t),t=null},10*n)}):A.add(+t,o)},stop:function(){n||clearInterval(n),f(),e||clearInterval(e),a||clearInterval(a),i||clearInterval(i),t||clearInterval(t),r||clearInterval(r),A.list=null},count:function(){p.STH().sale=g(A.l)},start:function(){n||this.stop(),A.list=[],t=setInterval(function(){_(A.l,s.add,s.remove)},3e3),n=setInterval(d,2e4),a=setInterval(function(){w(A)},3e3),e=setInterval(function(){j(A)},3e3),i=setInterval(function(){A.interval()},1e3),r=setInterval(function(){s.count()},300),d()}});var t,n,e,a,i,r,s,o,c,f,d,m,_=function(i,r,s){p.DB.gISIS().then(function(n){var e=Object.keys(i).map(function(t){return parseInt(t)}),t=n.filter(function(t){return-1===e.indexOf(t)}),a=e.filter(function(t){return-1===n.indexOf(t)});t.length&&r(t),a.length&&s(a)}).finally(function(){i=r=s=null})},h=(m={},function(t,n){var e=now();return void 0===n?(m[t]={time:e+3e4,val:n},n):!(n=m[t])||n.time<e?null:n.val}),v=function(i,r,s){var t,n;p.STH("data").wOptSellIsAuto?(n=function(t){var n,e,a;t.length?(t=t.sort(function(t,n){return t.price>n.price?1:-1}),a="number"==typeof(a=p.STH("data").wOptSellIsAutoVtep||"1")?a:+a||0,e=p.STH("myListings").getSellPriseMin(i.appid,i.market_hash_name),n=t[0].price,t=e&&e===n?t[0].subtotal:(e=i.publisher_fee_percent,H(n-a,e)),s(Math.max(t,r))):s(null),i=null},(1==(t=i).buy_type?S:y)(t,n)):s(r)},g=function(t){var n,e=0;if(p.STH().start)for(n in t)t[n]&&(e+=t[n].selsCnt||0);return e},S=function(n,e){var t,a,i,r=n.publisher_fee_percent,s=p.STH().authS();s?(t=s.TwoFactor?0:1,a="https://steamcommunity.com/market/itemordershistogram?"+["country="+s.country,"language="+s.language,"currency="+s.currency,"item_nameid="+n.item_nameid,"two_factor="+t].join("&"),(i=h(a))?e(i):p.STH("SS").ordershistogram?p.app.tabGetPrice({country:s.country,language:s.language,currency:s.currency,item_nameid:n.item_nameid,two_factor:t},function(t){t=+t.lowest_sell_order||0,t=[l(t,H(t,r))];h(a,t),e(t),a=n=e=null},function(){e([]),json=a=n=e=null}):e([])):e([])},y=function(t,i){var r=t.url,n=h(r);n?i(n):p.STH("SS").page?p.get(t.url).done(function(t){var n,e,a=(t.match(/(?:g_rgListingInfo[\s]*\=[\s]*)(\{[^;]+\})/g)||[]).pop(),t=(t.match(/(?:g_rgAssets[\s]*\=[\s]*)(\{[^\n]+\};)/g)||[]).pop();if(a&&t){try{n=JSON.parse(a.replace(/(?:g_rgListingInfo[\s]*\=[\s]*)(\{[^;]+\})/g,"$1"))||{},e=JSON.parse(t.replace(/(?:g_rgAssets[\s]*\=[\s]*)(\{[^\n]+\});{0,1}/g,"$1"))||{}}catch(t){return}a=T(n,e).map(function(t){return l(t.price,t.subtotal)});h(r,a),i(a)}}).fail(function(t){p.STH().error="STHS-2 - Recuest status:"+t}).always(function(){r=i=null}).l("page"):i([])},T=function(t,n){var e,a,i,r,s,l,u,o,c,f=[],d=(p.STH().authS()||{}).TwoFactor;for(a in t)e=t[a],i=e,r=d,s=c=o=u=l=s=void 0,s=parseInt,l=s(i.converted_price_per_unit),u=s(i.converted_price_per_unit)+s(i.converted_fee_per_unit),o=s(i.converted_fee_per_unit),c=s(i.converted_publisher_fee_per_unit),s=s(i.converted_steam_fee_per_unit),(c=o==c+s&&u==l+c+s&&(r&&(u-=s,o-=s),{currencyid:i.converted_currencyid,listingid:i.listingid,subtotal:l,fee:o,total:u,price:u}))&&c.price&&((r=n[e.asset.appid][e.asset.contextid][e.asset.id]).owner||2!=r.status||f.push(c));return f},H=function(t,n){return I(Math.max(parseInt(t/(105+(n||10))*100),1),t,n)};function I(t,n,e){a=t,i=e;var a,i=Math.max(a,1)+Math.max(Math.floor(a*(i||10)/100),1)+Math.max(Math.floor(.05*a),1);return n<=t?0:i===n?t:n<i?t-1:I(t+1,n,e)}b=O=0;var O,b,w=function(t){if(0<O)return O--;if(!p.STH("isPay")||!p.STH("data").wOptSellIsAuto||!p.STH("data").wOptSellCorrectReplase)return-2;var n=Object.keys(t.l),e=n.length;if(!e)return e;for(var a=0,i=Math.max(Math.min(b,e-1),0);0==a||b!=i;){var r=n[b];if(e<++b&&(b=0),!t.l[r])return void(a=10);r=t.l[r].data;if(!r)return-1;if(function(t){var i=p.STH("myListings").get("S",t.appid,t.market_hash_name);return i&&(p.DB.item.getOne(t.id).then(function(t){var a;t&&t[u]&&v(a=t,a.s_summ,function(t){if(t){var n,e=[];for(n in i)(i[n].subtotal>t||i[n].subtotal<a.s_summ)&&e.push(n);e.length&&p.STH("myListings").doSellItemsRemove(a.appid,a.market_hash_name,a.id,e)}})}),!0)}(r))return;a++}O=Math.min(a,100)};var k=function(e){var n,a,i,t=p.STH().authS();n=e,Object.keys(n||{}).forEach(function(t){n[t]=null,delete n[t]}),t&&p.STH("auth")()&&p.STH("start")&&p.STH("isPay")&&(a="https://steamcommunity.com/inventory/"+t.id+"/",i="?l="+t.language,p.DB.adata().then(function(t){Object.keys(t).forEach(function(n){Object.keys(t[n]).forEach(function(t){x(a+n+"/"+t+i,e)})})}).finally(function(){e=null}))};function x(c,f,t){t=t?c+"&count=2000&start_assetid="+t:c+"&count=75";p.get(t,"json").done(function(t){var n,e="descriptions";if(p.STH("start")){for(n in t[e]){o=u=l=s=r=i=a=void 0;var a=t[e][n],i=t.assets,r=f;if(a.marketable){var s="classid",l=a.market_hash_name||a.market_name||a.name,u=(r[l]=[],a[s]);if(u)for(var o in i)i[o][s]==u&&r[l].push(i[o])}}t.last_assetid&&x(c,f,t.last_assetid)}}).fail(function(t){p.STH().error='STH.GET - Request "inventory" Status Code: '+t}).always(function(){f=null})}var j=function(s){var t,l;p.STH("isPay")&&s.list&&(t=s.list.shift())&&(l=t,p.DB.item.getOne(l).then(function(t){if(t&&t[u]){var n=s.l[l],e=M,a=n.data=t,i=n.last_data;if(p.STH("isPay")&&a&&i&&i.length){var r=i.shift();v(a,a.s_summ,function(t){e(i,r,!t?false:p.app.sell({appid:a.appid,contextid:a.contextid,price:t,classid:r.classid,amount:r.amount,assetid:r.id||r.assetid,id:a.id}));a=r=null})}}}).finally(function(){s=null}))};function M(t,n,e){e||t.push(n)}var E,P,A=P={add:function(t,n){if(P.l[t])return P.l[t];t=P.l[t]={selsCnt:0,id:t,__last_data:n,get last_data(){var t=this.__last_data,n=this.data,n=!!n&&n.market_hash_name;return t[n]?new Object(t[n]):(B(this),null)}};B(t)},stop:function(t){var n,e;t.forEach?t.forEach(P.stop):(e=P.l[t],P.list&&~(n=P.list.indexOf(t))&&P.list.splice(n,1),e&&(e=e.__last_data=e.data=P.l[t]=null,delete P.l[t]))},l:{},list:null,interval:function(){var t=Object.keys(P.l),n=t.length;n&&(t=t[E=(E=-~E)>=n?0:E],(n=P.l[t]).data?n.last_data&&(n.selsCnt=n.last_data.length,P.list)&&!~P.list.indexOf(n.id)&&P.list.push(n.id):B(n))}};function B(n){p.DB.item.getOne(n.id).then(function(t){n.data=t||{}}).finally(function(){n=null})}}(this);